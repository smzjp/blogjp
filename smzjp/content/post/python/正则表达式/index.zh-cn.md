---
original: true
title: 正则表达式的使用
description: 正则的常用语法
date: 2022-08-20
slug: 
image: 
tags:
    - regex
    - re
categories:
    - Python
---

正则表达式，如果是匹配多次，第一次匹配到了，第二次匹配的时候是从剩下的字符从新开始匹配。

#### 通配符

通配符 **.** 可以匹配任何除换行符以外的字符，有且只能匹配一个字符，不能多也不能少。

```python
import re

ret = re.findall(".", "a,b,c,d,e")
# 结果
# ['a', ',', 'b', ',', 'c', ',', 'd', ',', 'e']
```

全部都匹配到了，返回结果是一个数组

```python
import re

ret = re.findall("a.b", "a,b,c,d,e,ab,abb,a\tb,a\nb")
# 结果
# ['a,b', 'abb', 'a\tb']
```

匹配到了三个结果

#### 字符集

字符集`[]`多选一的意思，表示匹配`[]`里面的其中一个，也是有且只能匹配一个字符，不能多，也不能少。

```python
import re

ret = re.findall("[ace]", "a,b,c,d,e")

# 结果
# ['a', 'c', 'e']
```

匹配到了三个结果。第一次从字符集里面取出a匹配一遍，看有哪些是符号条件的，第二次从字符集里面取出c匹配，等所以字符集里面的字符都匹配一遍，把结果合并。

```python
import re
ret = re.findall("a[bce]f", "af,abf,abbf,acef,aef,abf")
# 结果
# ['abf', 'aef', 'abf']
```

匹配到了三个结果，第一次用abf匹配，找到所有结果。第二次匹配的字符串是截取后的，类似于split函数把字符串通过abf分段，然后再用acf去匹配每一段。

```python
import re
ret = re.findall("[0123456789]", "a,b,2,d,c,8,B,C,F")
# 结果
# ['2', '8']
```

匹配所有的数字，要注意字符集`[]`每次只能取一个字符用来匹配。`[0123456789]`写起来有些麻烦，可以用`[0-9]`简写，还可以用 `\d`简写表示，都表示一个意思，匹配所有的数字。

```python
import re
ret = re.findall("[0-9a-zA-Z]", "a,b,2,d,c,8,B,C,F")
# 结果
# ['a', 'b', '2', 'd', 'c', '8', 'B', 'C', 'F']
```

匹配所有的数字和大小写字母，`[0-9a-zA-Z]`一般也可以简写成`\w` ，`\w`表示匹配所有的大小写字母和数字和下划线`_`。

#### 重复元字符

重复相关的元字符 `*`,`+`,`?`,`{}`是用来修饰字符集或者通配符的，默认都是贪婪匹配的，贪婪匹配每次匹配会匹配最多的符合条件的字符。

1. `+`表示重复1-多次，结果最少要匹配成功1次

   ```python
   import re
   ret = re.findall(r"\d+", "a,b,23355,d,6,88888888")
   # 结果
   # ['23355', '6', '88888888']
   ```

   如果要取消贪婪匹配，可以在重复元字符后面加 `?`

   ```python
   import re
   ret = re.findall(r"\d+?", "a,b,23355,d,6,88888888")
   # 结果
   # ['2', '3', '3', '5', '5', '6', '8', '8', '8', '8', '8', '8', '8', '8']
   ```

2. `*`表示重复0-多次，最少匹配成功0次，可以匹配不成功，也就是匹配的结果可以为空。

   ```python
   import re
   ret = re.findall(r"\d*", "a,b,23355,d,6,88888888")
   # 结果
   # ['', '', '', '', '23355', '', '', '', '6', '', '88888888', '']
   ```

   可以看到结果有空的字符串。可以这么理解，当匹配字符串下标为0的a时，没匹配上，但是因为`*`是可以匹配0次到多次，所以这次匹配会返回一个""空的字符，然后下标右移一位，继续下一次的匹配。

3. `{n}`表示匹配固定的n个字符长度。

   ```python
   import re
   ret = re.findall("\w{6}", "apple,bananaq,orange,melon")
   # 结果
   # ['banana', 'orange']
   ```

   匹配六个字符长度的字符串，字符串是由字母，数字或下划线组成。也可以`{m,n}`表示匹配m到n次，`{m,}`表示至少匹配m次

4. `?`匹配0次或者1次

   ```python
   import re
   ret = re.findall("abc?", "abc,abcc,abe,ab")
   # 结果
   # ['abc', 'abc', 'ab', 'ab']
   ```

   注意重复元字符`?`修饰的是字符`c`。如果要取消贪婪匹配，可以在`?`后面再加一个`?`,也就是`abc??`。

   `?`的两种用法要区分开来，如果是在重复元字符后面出现，表示取消贪婪 比如 `*?` ` +?` ` ??` 其他地方表示重复0或者1次。

#### 位置元字符

位置元字符有两个 `^`和`$`用来限制字符的位置。

1. `^`表示起始位置，必须从起始下标0开始匹配。

   ```python
   import re
   ret = re.findall(r"^\d+", "32,banana,255,orange,454456")
   # 结果
   # ['32']
   ```

   表示匹配字符串开头的连续数字。如果不是以数字开头就匹配不到

   `^`还有一种用法，用在字符集`[]`里面，表示非

   ```python
   import re
   ret = re.findall("[^0-9]", "a,b,2,d,c,8,B,C,F")
   # 结果
   # ['a', ',', 'b', ',', ',', 'd', ',', 'c', ',', ',', 'B', ',', 'C', ',', 'F']
   ```

   表示匹配所有非数字。

2. `$`表示结束位置，从字符串最后面开始匹配。

   ```python
   import re
   ret = re.findall(r"\d+$", "32,banana,255,orange,454456")
   # 结果
   # ['454456']
   ```

   表示匹配以数字结尾的字符 ，如果不是以数字结尾就匹配不到。

#### 其他元字符

1. `()`模式捕获，具有提取指定数据的能力。

   ```python
   import re
   ret = re.findall(r",(\w{5}),", ",apple,banana,peach,orange,melon,")
   # 结果
   # ['apple', 'peach', 'melon']
   ```

   对取到的值进行过滤，只取`()`里面的值。

   ```python
   import re
   ret = re.findall(r",\w{5},", ",apple,banana,peach,orange,melon,")
   # 结果
   # [',apple,', ',peach,', ',melon,']
   ```

   对比下 不加`()`的结果,其的头尾都是有`,`逗号的。如果需要取消模式捕获，可以在左括号的后面加上`?:`,比如 `(?:\w{5})`。

2. `|`表示或的效果

   ```python
   import re
   ret = re.findall(r"\w+@(?:163|qq).com", "123dn@163.com,.....3n4n5@qq.com......nene.3nn56@gmail.com....enen")
   
   # 结果
   # ['123dn@163.com', '3n4n5@qq.com']
   ```

   表示匹配所有的qq邮箱和163邮箱。`|`一般是跟`(?:)`一起使用。

3. 正向先行断言

   ```python
   import re
   ret = re.findall("\d+(?=PM)", "Date: 4 Aug 3PM 6")
   
   # 结果
   # ['3']
   ```

   表示 只匹配数字后面是PM的数字  格式`(?=PM)`

4. 负向先行断言

   ```python
   import re
   ret = re.findall("\d+(?!PM)", "Date: 4 Aug 3PM 6")
   
   # 结果
   # ['4', '6']
   ```

   只匹配数字后面不是PM的数字 格式`(?!PM)`

5. 正向后行断言

   ```python
   import re
   ret = re.findall("(?<=\$)\d+","Product Code: 1064 Price: $5 ¥67")
   
   # 结果
   # ['5']
   ```

   匹配数字，数字需满足前面有$的数字 格式 `(?<=\$)` 注意，如果是特殊符号记得加`\`，取消其特殊含义，`$`,`¥`等都需要加`\`。

6. 负向后行断言

   ```python
   import re
   ret = re.findall("(?<!\$)\d+", "Product Code: 1064 Price: $5")
   
   # 结果
   # ['1064']
   ```

   匹配数字，数字需满足前面不是 `$`的数字。

#### 转义符号

转义符号 `\`有两种用法

1. 将一些普通符号赋予特殊功能。

   1. `\d`表示`[0-9]`
   2. `\D`表示 `[^0-9]`
   3. `\w`表示 `[0-9a-zA-Z_]`
   4. `\W`表示 `[^0-9a-zA-Z_]`
   5. `\s`表示 仅匹配空白字符
   6. `\S`表示 匹配除空白外的字符

2. 将特殊符号(元字符)取消其特殊功能 `\*`   `\.`  `\+`  `\?`

   ```python
   import re
   ret = re.findall(r"\*", "*** ??? ___")
   
   # 结果
   # ['*', '*', '*']
   ```

   匹配`*`号

#### 典型例子

1. 例子1

   ```python
   import re
   text = "<12> <xzy> <!@#$%> <1a!#e2> <>"
   ret = re.findall("<.+>", text)
   
   # 结果
   # ['<12> <xzy> <!@#$%> <1a!#e2> <>']
   ```

   注意结果只有一个，返回的是一整个字符串。

   ```python
   import re
   text = "<12> <xzy> <!@#$%> <1a!#e2> <>"
   ret = re.findall("<.+?>", text)
   
   # 结果
   # ['<12>', '<xzy>', '<!@#$%>', '<1a!#e2>']
   ```

   匹配到了四个结果，跟上面的例子比，加了个`?`，表示取消贪婪匹配。

2. 例子2

   ```python
   import re
   text = """
   <1
   2> <x
   zy> <!@#$%> <1a
   !#e2> <>
   """
   # 修饰模式 默认是re.I 意思是 .可以匹配换行符外的所有字符
   ret = re.findall("<.*?>", text, re.I)
   
   # 结果
   # ['<!@#$%>', '<>']
   ```

   如果想要换行符 `.`也可以匹配到，可以设置修饰模式

   ```python
   import re
   text = """
   <1
   2> <x
   zy> <!@#$%> <1a
   !#e2> <>
   """
   # 修饰模式 re.S 意思是 .可以匹配所有字符，包括换行符
   ret = re.findall("<.*?>", text, re.S)
   
   # 结果
   # ['<1\n2>', '<x\nzy>', '<!@#$%>', '<1a\n!#e2>', '<>']
   ```

   匹配到了五个结果，这个模式在爬虫里面比较用的到。











